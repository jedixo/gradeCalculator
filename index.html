<html>

<head>
    <title>Assessment calc</title>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>

    <SCRIPT language="javascript">
        var index = 0;
        var gradeData = [];
        var outputs = [];
        var data = [];
        var progbarcol = ["progress-bar progress-bar", "progress-bar progress-bar bg-success",
            "progress-bar progress-bar bg-info", "progress-bar progress-bar bg-warning",
            "progress-bar progress-bar bg-danger"];

        //initialises data needed for calculations
        function init() {
            //grabs output elements
            gradeData.push(document.getElementById("neededC"));
            gradeData.push(document.getElementById("neededD"));
            gradeData.push(document.getElementById("neededHD"));
            gradeData.push(document.getElementById("totEarned"));
            gradeData.push(document.getElementById("avgMark"));
            gradeData.push(document.getElementById("neededP"));
            //sets initital values for outputs
            for (var i = 0; i < gradeData.length; i++) {
                gradeData[i].innerHTML = "0%";
                outputs.push(0);
            }
            //final exam worth if needed
            outputs.push(0);
        };

        //adds a new subject table
        function addNew() {
            var io = []

            var tr = document.createElement("tr");
            tr.setAttribute("id", "sub" + index);

            var tdname = document.createElement("td");
            tdname.setAttribute("id", "name" + index);
            var inpdiv = document.createElement("div");
            inpdiv.setAttribute("class", "input-group");
            var inpname = document.createElement("input");
            inpname.setAttribute("type", "text");
            inpname.setAttribute("id", "nameInput" + index);
            inpname.setAttribute("class", "form-control");
            inpname.setAttribute("placeholder", "Assessment Name");
            inpname.setAttribute("aria-describedby", "basic-adon1");
            inpdiv.appendChild(inpname)
            tdname.appendChild(inpdiv);
            tr.appendChild(tdname);

            var tdworth = document.createElement("td");
            tdworth.setAttribute("id", "worth" + index);
            var inpdivworth = document.createElement("div");
            inpdivworth.setAttribute("class", "input-group");
            var inpdivworthprep = document.createElement("div");
            inpdivworthprep.setAttribute("class", "input-group-append");
            var inpdivworthprepspan = document.createElement("span");
            inpdivworthprepspan.setAttribute("class", "input-group-text");
            inpdivworthprepspan.innerHTML = "%";
            inpdivworthprep.appendChild(inpdivworthprepspan);

            var ipworth = document.createElement("input");
            ipworth.setAttribute("type", "number");
            ipworth.setAttribute("class", "form-control");
            ipworth.setAttribute("aria-describedby", "basic-adon1");
            ipworth.setAttribute("id", "worthInput" + index);
            ipworth.setAttribute("placeholder", "100");
            io.push(ipworth);
            inpdivworth.appendChild(ipworth)
            inpdivworth.appendChild(inpdivworthprep);
            tdworth.appendChild(inpdivworth);
            tr.appendChild(tdworth);
            ipworth.addEventListener('input', function () {
                checkValid(ipworth);
            });

            var tdrec = document.createElement("td");
            tdrec.setAttribute("id", "rec" + index);
            var inpdivrec = document.createElement("div");
            inpdivrec.setAttribute("class", "input-group");
            var inpdivrecprep = document.createElement("div");
            inpdivrecprep.setAttribute("class", "input-group-append");
            var inpdivrecprepspan = document.createElement("span");
            inpdivrecprepspan.setAttribute("class", "input-group-text");
            inpdivrecprepspan.innerHTML = "%";
            inpdivrecprep.appendChild(inpdivrecprepspan);
            inpdivrec.appendChild(inpdivrecprep);
            var iprec = document.createElement("input");
            iprec.setAttribute("type", "number");
            iprec.setAttribute("class", "form-control");
            iprec.setAttribute("aria-describedby", "basic-adon1");
            iprec.setAttribute("id", "recInput" + index);
            iprec.setAttribute("placeholder", "100");
            io.push(iprec);
            inpdivrec.appendChild(iprec);
            inpdivrec.appendChild(inpdivrecprep);
            tdrec.appendChild(inpdivrec);
            tr.appendChild(tdrec);
            iprec.addEventListener('input', function () {
                checkValid(iprec);
            });

            var tdear = document.createElement("td");
            tdear.setAttribute("id", "ear" + index);
            var inpdivear = document.createElement("div");
            inpdivear.setAttribute("class", "input-group");
            var inpdivearprep = document.createElement("div");
            inpdivearprep.setAttribute("class", "input-group-append");
            var inpdivearprepspan = document.createElement("span");
            inpdivearprepspan.setAttribute("class", "input-group-text");
            inpdivearprepspan.innerHTML = "%";
            inpdivearprep.appendChild(inpdivearprepspan);

            var ipear = document.createElement("input");
            ipear.setAttribute("type", "number");
            ipear.setAttribute("class", "form-control");
            ipear.setAttribute("aria-describedby", "basic-adon1");
            ipear.setAttribute("id", "earInput" + index);
            ipear.setAttribute("value", "0");
            ipear.setAttribute("disabled", "true");
            io.push(ipear);
            inpdivear.appendChild(ipear)
            inpdivear.appendChild(inpdivearprep);
            tdear.appendChild(inpdivear);
            tr.appendChild(tdear);

            var tddel = document.createElement("td");
            tddel.setAttribute("id", "del" + index);
            tddel.setAttribute("class", "text-right");
            var tddelbut = document.createElement("button");
            tddelbut.setAttribute("type", "button");
            tddelbut.setAttribute("class", "btn btn-danger");
            tddelbut.setAttribute("disabled", "true");
            tddelbut.setAttribute("onclick", "removeRow(" + data.length + ");");
            tddelbut.innerHTML = "&#x268A";
            io.push(tddelbut);
            tddel.appendChild(tddelbut);
            tr.appendChild(tddel);

            var foo = document.getElementById("subtabbdy");
            foo.appendChild(tr);
            io.push(0);
            io.push(index);
            data.push(io);

            if (data.length > 1) {
                for (var i = 0; i < data.length; i++) {
                    data[i][data[i].length - 3].disabled = false;
                }
            }
            index++;
        }

        function removeRow(row) {
            document.getElementById("sub" + data[row][data[row].length - 1]).outerHTML = "";
            data.splice(row, 1);

            for (var i = 0; i < data.length; i++) {
                data[i][data[i].length - 3].setAttribute("onclick", "removeRow(" + i + ");");
                if (data.length === 1) {
                    data[i][data[i].length - 3].disabled = true;
                }
            }
        }

        function update() {
            var count = 0;
            var totalWorth = 0;
            var rreceived = 0;
            var totalEarned = 0;
            var avgReceived = 0;
            var finalWeight = 1;

            var pb = document.getElementById("progbar");
            pb.innerHTML = "";

            for (x = 0; x < data.length; x++) {
                var worth = data[x][0].value / 100;
                var received = data[x][1].value / 100;
                var earned = worth * received;
                data[x][2].value = parseFloat(earned * 100).toFixed(2);
                data[x][4] = earned;



                var suc = document.createElement("div");
                suc.setAttribute("class", progbarcol[x % 5]);
                suc.setAttribute("role", "progressbar");
                suc.setAttribute("style", "width: " + data[x][4] * 100 + "%");
                suc.setAttribute("aria-valuenow", "" + data[x][4] * 100);
                suc.setAttribute('aria-valuemin', "0");
                suc.setAttribute("aria-valuemax", "100");
                suc.innerHTML = "%" + parseFloat(data[x][4] * 100).toFixed(2)
                pb.appendChild(suc);



                totalWorth += worth;
                finalWeight -= worth;
                rreceived += received;
                totalEarned += earned;
                count++;
            }

            avgReceived = rreceived / count;
            outputs[4] = avgReceived * 100;
            outputs[3] = totalEarned * 100;
            outputs[6] = finalWeight * 100;
            cacluate();
        }

        function cacluate() {
            var mark = outputs[3];
            var finwei = outputs[6];
            var p = 0;
            var c = 0;
            var d = 0;
            var hd = 0;
            var tmp = 0;
            var tmp2 = 0;
            while (tmp2 < 85) {
                while (tmp2 < 75) {
                    while (tmp2 < 65) {
                        while (tmp2 < 50) {
                            tmp++;
                            var earned;
                            earned = tmp * finwei / 100;
                            tmp2 = mark + earned;
                            p = tmp;
                        }
                        tmp++;
                        var earned;
                        earned = tmp * finwei / 100;
                        tmp2 = mark + earned;
                        c = tmp;
                    }
                    tmp++;
                    var earned;
                    earned = tmp * finwei / 100;
                    tmp2 = mark + earned;
                    d = tmp;
                }
                tmp++;
                var earned;
                earned = tmp * finwei / 100;
                tmp2 = mark + earned;
                hd = tmp;
            }
            if (mark > 50) {
                p = 0;
                if (mark > 65) {
                    c = 0;
                    if (mark > 75) {
                        d = 0;
                        if (mark > 85) {
                            hd = 0;
                        }
                    }
                }
            }


            outputs[0] = c;
            outputs[1] = d;
            outputs[2] = hd;
            outputs[5] = p;

            updateUi();
        }

        function updateUi() {
            gradeData[0].innerHTML = outputs[0] + "%";
            gradeData[1].innerHTML = outputs[1] + "%";
            gradeData[2].innerHTML = outputs[2] + "%";
            gradeData[3].innerHTML = parseFloat(outputs[3]).toFixed(2) + "%";
            gradeData[4].innerHTML = parseFloat(outputs[4]).toFixed(2) + "%";
            gradeData[5].innerHTML = outputs[5] + "%";


        }

        function checkValid(element) {
            if (element.value == 101) {
                element.value = 100;
            } else if (element.value > 100) {
                element.value = parseInt(element.value / 10).toFixed(0);
            } else if (element.value < 0) {
                element.value = 0;
            }
        }

    </SCRIPT>
</head>

<body>
    <h1 class="text-center" style="width: 100%;">Jake's Grade Calculator -
        <small class="text-muted">Version 2.0</small>
    </h1>
    <div class="table-responsive mx-auto" style="width: 95%;">
        <table class="table table-striped table-dark" id="resultsTable" name="resultsTable">

            <thead>
                <tr>
                    <th class="text-center" scope="col" data-toggle="tooltip" title="<table ><tr><td class='text-center' style='color:White;'>Average mark per assessment</td></tr></table>">Average Mark</th>
                    <th class="text-center" scope="col" data-toggle="tooltip" title="<table ><tr><td class='text-center' style='color:White;'>Overal current grade</td></tr></table>">Total Currently Earned</th>
                    <th class="text-center" scope="col" data-toggle="tooltip" title="<table ><tr><td class='text-center' style='color:White;'>Grade needed for A High Distinction</td></tr></table>"
                        style='color:lightblue;'>Needed for HD</th>
                    <th class="text-center" scope="col" data-toggle="tooltip" title="<table ><tr><td class='text-center' style='color:White;'>Grade needed for A Distinction</td></tr></table>"
                        style='color:lightgreen;'>Needed for D</th>
                    <th class="text-center" scope="col" data-toggle="tooltip" title="<table ><tr><td class='text-center' style='color:White;'>Grade needed for A Credit</td></tr></table>"
                        style='color:lightgoldenrodyellow;'>Needed for C</th>
                    <th class="text-center" scope="col" data-toggle="tooltip" title="<table ><tr><td class='text-center' style='color:White;'>Grade needed for A Pass</td></tr></table>"
                        style='color:lightcoral;'>Needed for P</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="text-center" id="avgMark">0</td>
                    <td class="text-center" id="totEarned">0</td>
                    <td class="text-center" id="neededHD">0</td>
                    <td class="text-center" id="neededD">0</td>
                    <td class="text-center" id="neededC">0</td>
                    <td class="text-center" id="neededP">0</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="progbar" class="progress mx-auto mb-2" style="width: 95%; ">


    </div>
    <div style="padding-bottom: .8%"></div>
    <div class="table-responsive mx-auto" style="width: 95%;">
        <table class="table table-striped" id="subjectTable" name="subjectTable">

            <thead class="thead-dark">
                <tr>
                    <th class="text-center align-middle" scope="col" data-toggle="tooltip" title="<table ><tr><td class='text-center' style='color:White;'>Optional</td></tr></table>">Assessment Name</th>
                    <th class="text-center align-middle" scope="col" data-toggle="tooltip" title="<table ><tr><td class='text-center' style='color:White;'>Percentage of the subjects overall weight</td></tr></table>">Overall Weight</th>
                    <th class="text-center align-middle" scope="col" data-toggle="tooltip" title="<table ><tr><td class='text-center' style='color:White;'>Grade for individual assesment piece</td></tr></table>">Mark Received</th>
                    <th class="text-center align-middle" scope="col" data-toggle="tooltip" title="<table ><tr><td class='text-center' style='color:White;'>Percentage of overall subject grade</td></tr></table>">Overall Grade</th>
                    <th class="text-right" scope="col">
                        <button type="button" class="btn btn-primary " data-toggle="tooltip" data-placement="bottom" title="add another row" onclick="addNew()">&#x271A</button>
                    </th>
                </tr>
            </thead>
            <tbody id="subtabbdy">
            </tbody>
        </table>
    </div>
    <button type="button" class="btn btn-primary btn-lg btn-block mx-auto" style="width: 95%" onclick="update();">Calculate</button>
    <script>
        init(); addNew();
        $('th[data-toggle="tooltip"]').tooltip({ html: true });
        $('button[data-toggle="tooltip"]').tooltip({ html: true });</script>

</body>

</html>